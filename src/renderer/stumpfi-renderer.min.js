/** Copyright 2016 - present, Matthieu Jabbour <matthieu.jabbour@gmail.com>. All rights reserved. */
const specialCharsMap={'&amp;':'&','&lt;':'<','&gt;':'>','&quot;':'"','&#039;':'\'','&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;'},replacer=a=>specialCharsMap[a];function unescape(a){return a.replace(/(&amp;|&lt;|&gt;|&quot;|&#039;)/g,replacer)}function escape(a){return a.replace(/[&<>"']/g,replacer)}const contentTypesRenderers={SIMPLE_TEXT:a=>a,RICH_TEXT:a=>a,MEDIA:a=>a};window.onload=function(){const a=JSON.parse(unescape(document.body.childNodes[0].innerHTML));let b=!1;const c=h=>h.replace(/([A-Z])/g,'-$1').toLowerCase(),d=h=>{const i=h.attributes,j=Object.keys(i).reduce((k,l)=>'string'==typeof i[l]?`${k} ${c(l)}="${i[l]}"`:!0===i[l]?`${k} ${c(l)}`:k,'').trim();switch(h.type){case'style':return`<style ${j}>${h.content||''}</style>`;case'script':return`<script ${j}>${h.content||''}</script>`;default:return`<link ${j} />`;}},e=h=>{const i=`position: absolute;`+`width: ${h.dimensions.w}%;`+`height: ${h.dimensions.h}%;`+`top: ${h.coordinates.y}%;`+`left: ${h.coordinates.x}%;`,j=(()=>{let m=0;return(n,o)=>{if(null===h.contents[m]||void 0===h.contents[m])return++m,'';o!==a.contents[h.contents[m]].type&&(console.warn(`Content #${h.contents[m]}'s type is not compatible with ${o}.`),b=!0);const p=escape(a.contents[h.contents[m++]].markupText);return contentTypesRenderers[o](p)}})(),k=a.templates[h.template],l=k.code.replace(/\{\{(RICH_TEXT|SIMPLE_TEXT|MEDIA)\}\}/g,j);return`<div style="${i}">${l}</div>`},f=h=>{const i=[],j={};j.autoresizeScript=d({type:'script',attributes:{type:'text/javascript'},content:'function scale() {const fontSize = Math.min(16/9 * window.innerHeight / 100, window.innerWidth / 100);document.body.style.fontSize = `${fontSize}px`;}window.addEventListener(\'resize\', scale); window.onload = scale;'}),j.autoresizeStyle=d({type:'style',attributes:{type:'text/css'},content:'div[data-component-id]{overflow: auto; position: absolute;}body{width: calc(16/9 * 100vh); height: calc(9/16 * 100vw); max-width: 100vw;max-height: 100vh; position: relative; margin: 0;}'});for(let k=h;null!==k;)k.resources.forEach(m=>{j[m]=d(a.resources[m])}),k.components.forEach(m=>{i.unshift(e(a.components[m]));const n=a.components[m].template;a.templates[n].resources.forEach(o=>{j[o]=d(a.resources[o])})}),k=null===k.master?null:a.pages[k.master];const l=`<!DOCTYPE html>`+`<html>`+`<head>`+`${Object.keys(j).map(m=>j[m]).join('')}`+`</head>`+`<body>`+`${i.join('')}`+`</body>`+`</html>`;return`<iframe srcDoc="${escape(l)}" class="stumpfi page"></iframe>`};let g='';Object.keys(a.documents).forEach(h=>{a.documents[h].pages.forEach(i=>{g+=f(a.pages[i])}),document.body.innerHTML=g}),!0==b&&console.error('One or many errors occured during document rendering. This may affect displaying.')};